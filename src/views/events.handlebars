<div class="row">
    <div class="col-12">
        <div class="d-flex justify-content-between align-items-center mb-4">
            <h2>Events</h2>
            {{#if user}}
            {{#if (eq user.role "organizer")}}
            <a href="/dashboard" class="btn btn-primary">Create New Event</a>
            {{/if}}
            {{/if}}
        </div>

        {{#if events}}
        <div class="row">
            {{#each events}}
            <div class="col-md-6 col-lg-4 mb-4">
                <div class="card h-100">
                    <div class="card-body">
                        <h5 class="card-title">{{this.title}}</h5>
                        <p class="card-text">{{this.description}}</p>
                        <p class="card-text">
                            <small class="text-muted">
                                ğŸ“… {{formatDate this.date}}<br>
                                ğŸ“ {{this.location}}<br>
                                ğŸ‘¥ {{this.attendeesCount}}/{{this.capacity}} attendees
                            </small>
                        </p>
                        <div class="d-flex justify-content-between align-items-center">
                            <a href="/events/{{this.id}}" class="btn btn-outline-primary btn-sm">View Details</a>
                            {{#if ../user}}
                            {{#unless (includes this.attendees ../user._id)}}
                            <form action="/events/{{this.id}}/register" method="POST" class="d-inline">
                                <button type="submit" class="btn btn-success btn-sm">Register</button>
                            </form>
                            {{else}}
                            <form action="/events/{{this.id}}/register" method="POST" class="d-inline">
                                <input type="hidden" name="_method" value="DELETE">
                                <button type="submit" class="btn btn-danger btn-sm">Unregister</button>
                            </form>
                            {{/unless}}
                            {{/if}}
                        </div>
                    </div>
                </div>
            </div>
            {{/each}}
        </div>
        {{else}}
        <div class="text-center">
            <p class="text-muted">No events available at the moment.</p>
            {{#if user}}
            {{#if (eq user.role "organizer")}}
            <a href="/dashboard" class="btn btn-primary">Create Your First Event</a>
            {{/if}}
            {{/if}}
        </div>
        {{/if}}
    </div>
</div>
