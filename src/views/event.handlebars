<div class="container mx-auto px-4 py-8 reveal">
  <div class="bg-white rounded-lg shadow p-6 transition duration-300 glow">
    <h1 class="text-2xl font-bold text-gray-900 mb-2">{{event.title}}</h1>
    <p class="text-gray-600 mb-4">{{event.description}}</p>
    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm text-gray-700">
      <p><strong>Date:</strong> {{formatDate event.date}}</p>
      <p><strong>Location:</strong> {{event.location}}</p>
      <p><strong>Capacity:</strong> {{event.capacity}}</p>
      <p><strong>Attendees:</strong> {{event.attendees.length}} / {{event.capacity}}</p>
      <p><strong>Status:</strong> <span class="{{statusColor event.status}}">{{event.status}}</span></p>
    </div>
    <div class="mt-6 flex gap-3">
      {{#if user}}
        <button onclick="register('{{event._id}}')" class="bg-indigo-600 hover:bg-indigo-700 text-white font-medium px-4 py-2 rounded">Register</button>
        <button onclick="unregister('{{event._id}}')" class="bg-gray-100 hover:bg-gray-200 text-gray-800 font-medium px-4 py-2 rounded">Unregister</button>
      {{else}}
        <a href="/login" class="bg-indigo-600 hover:bg-indigo-700 text-white font-medium px-4 py-2 rounded">Login to register</a>
      {{/if}}
    </div>
  </div>
</div>

<script>
  function getToken() { return window.SERVER_TOKEN || localStorage.getItem('token'); }
  async function register(id) {
    try {
      const res = await fetch(`/api/events/${id}/register`, { method: 'POST', headers: { 'Authorization': 'Bearer ' + getToken() } });
      if (res.ok) { alert('Registered!'); location.reload(); } else { const e = await res.json(); alert(e.message || 'Failed'); }
    } catch (e) { alert('Error'); }
  }
  async function unregister(id) {
    try {
      const res = await fetch(`/api/events/${id}/register`, { method: 'DELETE', headers: { 'Authorization': 'Bearer ' + getToken() } });
      if (res.ok) { alert('Unregistered!'); location.reload(); } else { const e = await res.json(); alert(e.message || 'Failed'); }
    } catch (e) { alert('Error'); }
  }
</script>
